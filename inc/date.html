<HTML>
<HEAD>
<TITLE>选择日期</TITLE>
<script LANGUAGE="JScript.Encode">

//Begin     wl    目的:填写日期的代码.

var MAX_YEAR = 2099;
var MIN_YEAR = 1900;
var selected_day = 1;
function window_onload() {
	var today;
	if(window.dialogArguments!=null){
		today = new Date(window.dialogArguments[0].replace(/年/,'/').replace(/月/,'/').replace(/日/,''));
		if (isNaN(today))
			today = new Date();
	}
	else
		today = new Date();
	var mon = today.getMonth();
    Month.selectedIndex = mon;
    mon = today.getFullYear();
    Year.value = mon;
    mon = today.getDate();
    selected_day = mon;
    Month.onchange = redraw;
    redraw();
}

document.onclick = selectDate;
function selectDate()
{
	var obj = window.event.srcElement;
	if(obj.id.substr(0,4)=='date' && obj.children.length==0)
	{
	   var sel = obj.innerHTML;
	   obj.innerHTML= '<font class=SelectDate>'+sel+'</font>';
	   var oldobj = eval('document.all(\'date'+selected_day+'\')');
	   if (oldobj.children[0]!=null) oldobj.innerHTML = oldobj.children[0].innerHTML;
	   selected_day = sel;
	}
	
}

function createDays()
{
	var daystr = '<TABLE WIDTH="100%" BORDER=0 height=120 CELLSPACING=0 CELLPADDING=0><TR bgcolor=#808086 height="18px">' + 
	     '<TD align="center"><FONT Color="White">日</FONT></TD><TD align="center">一</TD><TD align="center">二</TD><TD align="center">三</TD><TD align="center">四</TD><TD align="center">五</TD><TD align="center"><FONT Color="White">六</FONT></TD></TR>';
	var mon = Month.selectedIndex + 1;
	var year = Year.value;
	var countMonth = new Date(year+'/'+mon+'/'+'1 8:00');
	var weekday = countMonth.getDay();
	var day = 0;
	for (var i=0;i<43;i++)
	{
		if (i % 7 ==0) daystr +='<TR>';
		if (i<weekday)
		{
			daystr +='<TD>&nbsp;</TD>';
		}
		else
		{
			day++;
			if (!IsDate(year+'-'+mon+'-'+day))
			{
				daystr += '</TR>';
				break;
			}
			else
			{
				if(day==selected_day)
				{
					daystr +='<TD id=date' + day + ' align="center"><font class=SelectDate>' + day + '</font></TD>';
				}
				else
				{
					daystr +='<TD id=date'+day+' align="center">'+day+'</TD>';
				}
				if (i % 7 ==6) daystr += '</TR>';
			}
		}
	}
	if(day<=selected_day) selected_day=day -1 ;
	daystr +='</TABLE>';
	return daystr;
	
}

document.onkeydown = keydown;
document.ondblclick = returnday;

function returnday()
{
	var year = Year.value;
	var mon = String(Month.selectedIndex + 1);
	var day = selected_day;
	if(mon.length<2)mon = '0'+mon;
	if(day.length<2)day = '0'+day;
	window.returnValue=year+'/'+mon+'/'+day;
	
	//alert('wangliang6179#163.com');
	window.close();
}

function redraw()
{
	DateList.innerHTML = createDays();
}

function keydown()
{
	if(window.event.srcElement.id=='Month') return;
	if (event.keyCode==27) window.close();
	if(window.event.keyCode==13) returnday();
}


function IsDate(DateString , Dilimeter)
{
   if (DateString==null) return false;
   if (Dilimeter=='' || Dilimeter==null)
      Dilimeter = '-';
   var tempy='';
   var tempm='';
   var tempd='';
   var tempArray;
   if (DateString.length<8 && DateString.length>10)
       return false;       
   tempArray = DateString.split(Dilimeter);
   if (tempArray.length!=3)
      return false;
   if (tempArray[0].length==4)
   {
      tempy = tempArray[0];
      tempd = tempArray[2];
   }
   else
   {
      tempy = tempArray[2];
      tempd = tempArray[1];
   }
   tempm = tempArray[1];
   var tDateString = tempy + '/'+tempm + '/'+tempd+' 8:0:0';
   var tempDate = new Date(tDateString);
   if (isNaN(tempDate))
      return false;
  if (((tempDate.getUTCFullYear()).toString()==tempy) && (tempDate.getMonth()==parseInt(tempm)-1) && (tempDate.getDate()==parseInt(tempd)))
   {
      return true;
   }
   else
   {
      return false;
   }
}
</script>
<style>
.clsButton
{
COLOR: black; CURSOR: hand; FONT-FAMILY: Webdings; FONT-SIZE: 5pt
}
body
{
font-size:12px;
}
table
{
font-size:12px;
}
td
{
font-size:12px;
}
.framebox
{
    BORDER-RIGHT: white 2px inset;
    PADDING-RIGHT: 0px;
    BORDER-TOP: white 2px inset;
    PADDING-LEFT: 0px;
    FONT-WEIGHT: bold;
    PADDING-BOTTOM: 0px;
    BORDER-LEFT: white 2px inset;
    CURSOR: hand;
    COLOR: #ffffff;
    PADDING-TOP: 0px;
    BORDER-BOTTOM: white 2px inset
}

.SelectDate
{
BACKGROUND-COLOR:#00008b;
COLOR:white;
}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312"></HEAD>
<BODY bgcolor="#ECE9D8" topmargin="10" onLoad="return window_onload()">
<P></P>
<FIELDSET style="HEIGHT: 180px; WIDTH: 180px" align=right>
<LEGEND>请双击选择日期</LEGEND>
    <TABLE BORDER=0 CELLSPACING=1 CELLPADDING=1 align=center valign="bottom" style="HEIGHT: 155px; WIDTH: 180px">
	<TR>
		
    <TD> 
      <select id=Year name=Year style="HEIGHT: 22px; WIDTH: 68px" onChange="redraw()">
        <SCRIPT LANGUAGE=javascript>
<!--
var MIN_YEAR = 1900;
var MAX_YEAR = 2101;
var today1 = new Date();
var todayC=parseInt(today1.getUTCFullYear())
for (i=MIN_YEAR;i<MAX_YEAR;i++)
  if (i!=todayC) 
    document.writeln("<option value=\""+ i +"\">"+ i +"年</option>");
  else
    document.writeln("<option value=\""+ i +"\" selected>"+ i +"年</option>");


//End      wl

//-->
</SCRIPT>
      </select></TD>
		
    <TD><SELECT id=select name=Month style="HEIGHT: 22px; WIDTH: 68px">
        <OPTION selected value=1>一月</OPTION>
        <OPTION value=2>二月</OPTION>
        <OPTION value=3>三月</OPTION>
        <OPTION value=4>四月</OPTION>
        <OPTION value=5>五月</OPTION>
        <OPTION value=6>六月</OPTION>
        <OPTION value=7>七月</OPTION>
        <OPTION  value=8>八月</OPTION>
        <OPTION value=9>九月</OPTION>
        <OPTION value=10>十月</OPTION>
        <OPTION value=11>十一月</OPTION>
        <OPTION value=12>十二月</OPTION>
      </SELECT> </TD>
	</TR>
	<TR>
		<TD colspan=2 valign=top bgcolor=white class=framebox><DIV id=DateList></DIV>
</TD>
	</TR>
</TABLE></FIELDSET>
</BODY>
</HTML>